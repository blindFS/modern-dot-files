#!/usr/bin/env nu

# This is a demo config to showcase some of the most important commands.
# It is meant to be changed and configured, as it is intentionally kept sparse.
# For a (much) more advanced configuration example see my dotfiles:
# https://github.com/FelixKratz/dotfiles

let plugin_dir = $"($env.CONFIG_DIR)/plugins"
source config.nu

##### Aerospace integration #####

def args_per_workspace [it: string] {
  ['--add' 'item' $"space.($it)" 'left']
  | append ['--set' $"space.($it)" $"icon=($it)" $"click_script=aerospace workspace ($it)"]
  | append ($config.workspace_default_args | arg_to_setting $plugin_dir)
}

let workspace_args = (aerospace list-workspaces --all
  | lines
  | each {|it| args_per_workspace $it})
  | flatten

(sketchybar
  --bar position=top height=25 blur_radius=20 color=0x00000000
  --add event toggle_stats
  --add event aerospace_mode_change
  --add event aerospace_workspace_change
  --default ...($config.default | arg_to_setting $plugin_dir)
  ...($workspace_args)
  ...($config.plugin_configs
      | each {|it| $it
        | build_sketchybar_args $plugin_dir}
      | flatten)
)

##### Force all scripts to run the first time (never do this in a script) #####
sketchybar --update
